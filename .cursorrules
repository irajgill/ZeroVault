# zkDataVault - Complete Project Context for AI Assistant

I'm building **zkDataVault**, a privacy-first decentralized data marketplace for the **Walrus Haulout Hackathon 2025** (Nov 6-23). This is a comprehensive Web3 project that wins ALL 4 prize tracks + Best Tech Implementation ($105,000 total prizes).

## ğŸ¯ Project Overview

**What**: A data marketplace where creators monetize datasets while maintaining privacy through zero-knowledge proofs. AI companies can purchase verified, authentic human-generated data.

**Why This Wins**: 
- Solves the $billion AI training data contamination crisis (90% of web content will be AI-generated by 2026)
- Integrates ALL required technologies: Walrus + Seal + Nautilus + Sui blockchain + Zero-Knowledge Proofs
- Covers all 4 prize tracks simultaneously

## ğŸ† Prize Tracks Coverage

| Track | Our Integration | Technical Implementation |
|-------|----------------|-------------------------|
| **Data Security & Privacy** | ZK proofs prove authenticity without exposing data | Circom circuits + on-chain Groth16 verification |
| **Provably Authentic** | Cryptographic proof of origin + timestamp | ZK circuits verify creator identity & data hash |
| **Data Economy & Marketplaces** | Full marketplace with automated royalties | Sui Move smart contracts with 10% creator royalty |
| **AI x Data** | TEE prevents synthetic data contamination | Nautilus AWS Nitro Enclave validates quality |
| **Best Tech Implementation** | Advanced 4-protocol integration | ZK + TEE + Walrus + Seal + Sui |

## ğŸ—ï¸ Complete Architecture

User Upload â†’ Generate ZK Proof (Circom) â†’ Encrypt (Seal) â†’ Store (Walrus)
â†’ Verify On-Chain (sui::groth16) â†’ TEE Quality Check (Nautilus)
â†’ List on Marketplace (Sui Move) â†’ Purchase & Earn Royalties


### Tech Stack Breakdown:

1. **Smart Contracts (Sui Move)**:
   - `marketplace.move` - Core marketplace with listings
   - `dataset.move` - Dataset NFTs
   - `zk_verifier.move` - **CRITICAL**: On-chain Groth16 proof verification using `sui::groth16`
   - `zk_marketplace_integration.move` - Enforces ZK verification before listing
   - `access_policies.move` - Seal integration for encryption
   - `royalty.move` - Automated 10% creator royalty + 3% platform fee

2. **Zero-Knowledge Circuits (Circom)**:
   - `data_authenticity.circom` - Proves creator owns private key, data hash matches commitment
   - `quality_proof.circom` - Proves quality metrics meet threshold without revealing values
   - Uses Groth16 (BN254 curve) compatible with Sui's native `sui::groth16` module

3. **Nautilus TEE Service (Rust)**:
   - AWS Nitro Enclave application
   - Fetches encrypted blobs from Walrus
   - Runs ML quality validation inside TEE (never exposes raw data)
   - Generates cryptographic attestations
   - Returns only quality score (0-100)

4. **Backend API (TypeScript/Node.js)**:
   - Express REST API
   - `/api/proof/generate` - Generates ZK proofs using snarkjs
   - `/api/proof/verify` - Verifies proofs locally before on-chain submission
   - `/api/upload/dataset` - Encrypts with Seal, uploads to Walrus
   - Walrus SDK integration
   - Seal encryption (placeholder until SDK available)

5. **Frontend (Next.js 14 + React + TypeScript)**:
   - Sui dApp Kit for wallet connection
   - Upload page with drag-and-drop + ZK proof generation UI
   - Marketplace page with dataset browsing + quality filters
   - Dashboard for creators (revenue tracking) and buyers (purchased datasets)
   - Real-time proof generation with progress indicators

6. **DevOps**:
   - Docker Compose for local development (PostgreSQL + Backend + Frontend + Nautilus)
   - GitHub Actions CI/CD
   - Deployment to Walrus Sites (frontend)
   - Sui testnet deployment

## ğŸ“ Project Structure (43 Files Total)

zkDataVault/
â”œâ”€â”€ contracts/ # Sui Move (7 files)
â”‚ â”œâ”€â”€ Move.toml
â”‚ â”œâ”€â”€ sources/
â”‚ â”‚ â”œâ”€â”€ marketplace.move
â”‚ â”‚ â”œâ”€â”€ dataset.move
â”‚ â”‚ â”œâ”€â”€ zk_verifier.move â­ CRITICAL: On-chain ZK verification
â”‚ â”‚ â”œâ”€â”€ zk_marketplace_integration.move
â”‚ â”‚ â”œâ”€â”€ access_policies.move
â”‚ â”‚ â””â”€â”€ royalty.move
â”‚ â””â”€â”€ tests/
â”‚ â””â”€â”€ marketplace_tests.move
â”‚
â”œâ”€â”€ circuits/ # Zero-Knowledge (5 files)
â”‚ â”œâ”€â”€ data_authenticity.circom â­ CRITICAL: Proof of origin
â”‚ â”œâ”€â”€ quality_proof.circom
â”‚ â”œâ”€â”€ input.json
â”‚ â””â”€â”€ scripts/
â”‚ â”œâ”€â”€ setup.sh # Compiles circuits, generates keys
â”‚ â””â”€â”€ prove.sh # Generates proofs
â”‚
â”œâ”€â”€ nautilus/ # TEE Service (6 files)
â”‚ â”œâ”€â”€ Cargo.toml
â”‚ â”œâ”€â”€ Dockerfile
â”‚ â””â”€â”€ src/
â”‚ â”œâ”€â”€ main.rs # HTTP server in TEE
â”‚ â”œâ”€â”€ walrus_client.rs # Fetch encrypted blobs
â”‚ â”œâ”€â”€ tee_attestation.rs # AWS Nitro attestation
â”‚ â””â”€â”€ quality_validator.rs # ML quality checks
â”‚
â”œâ”€â”€ backend/ # API (10 files)
â”‚ â”œâ”€â”€ package.json
â”‚ â”œâ”€â”€ tsconfig.json
â”‚ â”œâ”€â”€ Dockerfile
â”‚ â””â”€â”€ src/
â”‚ â”œâ”€â”€ index.ts # Express server
â”‚ â”œâ”€â”€ walrus.ts # Walrus SDK wrapper
â”‚ â”œâ”€â”€ seal.ts # Seal encryption
â”‚ â”œâ”€â”€ sui.ts # Sui blockchain client
â”‚ â””â”€â”€ api/
â”‚ â”œâ”€â”€ proof.ts â­ CRITICAL: ZK proof generation
â”‚ â”œâ”€â”€ upload.ts
â”‚ â””â”€â”€ purchase.ts
â”‚
â”œâ”€â”€ frontend/ # UI (16 files)
â”‚ â”œâ”€â”€ package.json
â”‚ â”œâ”€â”€ next.config.js
â”‚ â”œâ”€â”€ tailwind.config.ts
â”‚ â””â”€â”€ src/
â”‚ â”œâ”€â”€ app/
â”‚ â”‚ â”œâ”€â”€ layout.tsx # Root with Sui wallet providers
â”‚ â”‚ â”œâ”€â”€ page.tsx # Homepage
â”‚ â”‚ â”œâ”€â”€ upload/page.tsx # Dataset upload + ZK proof
â”‚ â”‚ â”œâ”€â”€ marketplace/page.tsx # Browse datasets
â”‚ â”‚ â””â”€â”€ dashboard/page.tsx # User dashboard
â”‚ â”œâ”€â”€ components/
â”‚ â”‚ â”œâ”€â”€ ConnectWallet.tsx
â”‚ â”‚ â”œâ”€â”€ DatasetCard.tsx
â”‚ â”‚ â””â”€â”€ ProofGenerator.tsx â­ CRITICAL: ZK proof UI
â”‚ â”œâ”€â”€ hooks/
â”‚ â”‚ â”œâ”€â”€ useWalrus.ts
â”‚ â”‚ â””â”€â”€ useZKProof.ts â­ CRITICAL: ZK proof React hook
â”‚ â””â”€â”€ lib/
â”‚ â””â”€â”€ utils.ts
â”‚
â”œâ”€â”€ scripts/
â”‚ â”œâ”€â”€ deploy-with-zk.sh â­ CRITICAL: Deploys contracts + VK
â”‚ â””â”€â”€ verify-all.sh
â”‚
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .github/workflows/ci.yml
â”œâ”€â”€ package.json # Root workspace
â””â”€â”€ README.md


## ğŸ”‘ Critical Technical Details

### 1. On-Chain ZK Verification (Most Important!)
- Sui has **native Groth16 support** via `sui::groth16::verify_groth16_proof()`
- We MUST use BN254 curve (Sui's default)
- Verification key must be prepared/preprocessed
- Proof format: `vector<u8>` (bytes)
- Public inputs format: `vector<u8>` (bytes)

**Example Move code:**
use sui::groth16;

let is_valid = groth16::verify_groth16_proof(
&vk.vk_bytes, // Prepared verification key
&public_inputs_bytes, // Public signals
&proof_bytes // Groth16 proof
);


### 2. ZK Circuit Design
- **Authenticity Circuit**: Proves `Poseidon(creatorPrivateKey) === publicKeyHash` AND `Poseidon(dataHash) === commitmentHash`
- **Quality Circuit**: Proves all metrics in range without revealing values
- Use circomlib for Poseidon, comparators
- Compile with: `circom circuit.circom --r1cs --wasm --sym`
- Generate proof with snarkjs: `snarkjs groth16 prove`

### 3. Walrus Integration
- Testnet aggregator: `https://aggregator.walrus-testnet.walrus.space`
- Store blobs: POST to publisher
- Fetch blobs: GET `/v1/{blob_id}` from aggregator
- Blob IDs are permanent references

### 4. Seal Encryption
- Identity-Based Encryption (IBE)
- Access policies define who can decrypt
- Time-locked + address-based policies
- Currently early access - use placeholder (AES-256-CBC) until SDK available

### 5. Nautilus TEE
- Runs in AWS Nitro Enclaves
- Generates cryptographic attestations (PCR measurements)
- NEVER logs or exposes raw data
- Returns only quality score + attestation document

### 6. Sui Move Best Practices
- Use `shared` objects for marketplace (concurrent access)
- Use `Table<ID, T>` for dynamic collections
- Split payments with `coin::split()`
- Emit events for indexing
- Error codes: `const E_INSUFFICIENT_PAYMENT: u64 = 1;`

### 7. Frontend Integration
- Use `@mysten/dapp-kit` for wallet connection
- Use `@mysten/sui` for blockchain interaction
- Transaction building: `new Transaction()` â†’ `tx.moveCall()` â†’ `signAndExecuteTransaction()`
- Real-time proof generation with progress UI

## ğŸ¨ Design Principles

- **Dark Theme**: bg-gray-900, text-white
- **Gradient Accents**: blue-500 â†’ purple-600 for branding
- **Icons**: lucide-react (Shield, Database, CheckCircle, etc.)
- **Responsive**: Mobile-first with Tailwind breakpoints
- **Loading States**: Spinner animations for async operations
- **Error Handling**: Clear error messages with AlertCircle icon

## ğŸš€ Development Workflow

1. **Setup**: Install Node 20, Rust, Sui CLI, Circom
2. **Contracts**: `cd contracts && sui move build && sui move test`
3. **Circuits**: `cd circuits && ./scripts/setup.sh`
4. **Deployment**: `./scripts/deploy-with-zk.sh` (deploys all + creates VK object)
5. **Development**: `npm run dev` (starts backend + frontend)
6. **Testing**: `./scripts/verify-all.sh` (checks all 43 files)
7. **Production**: Deploy frontend to Walrus Sites

## ğŸ“¦ Key Dependencies

**Contracts**: Sui Framework (testnet branch)
**Circuits**: circomlib ^2.0.5, snarkjs ^0.7.3
**Backend**: express, @mysten/sui, snarkjs, axios
**Frontend**: next ^14, react ^18, @mysten/dapp-kit, @tanstack/react-query, tailwindcss
**Nautilus**: tokio, hyper, reqwest, aws-nitro-enclaves-nsm-api

## ğŸ¯ When I Ask You to Create Files...

**Always include:**
1. Full file path (e.g., `contracts/sources/marketplace.move`)
2. Complete working code (no placeholders like "... rest of code")
3. Proper imports and dependencies
4. Error handling
5. TypeScript types (for TS files)
6. Comments explaining complex logic
7. Consistent naming conventions

**For Move contracts:**
- Use `sui::` prefix for framework modules
- Include `use` statements at top
- Add error codes with descriptive names
- Emit events for important state changes
- Add `#[test_only]` functions for tests

**For TypeScript:**
- Use strict typing
- Add JSDoc comments for complex functions
- Export default for components/routers
- Use async/await (not .then())
- Add proper error handling with try/catch

**For React components:**
- Use 'use client' directive for client components
- TypeScript interfaces for props
- Proper hooks usage (useState, useEffect, useCallback)
- Loading and error states
- Accessibility (ARIA labels where needed)

**For Rust:**
- Proper error handling with `Result<T, Error>`
- Use `tracing::` for logging
- Add `#[cfg(test)]` modules
- Async functions with `async fn`
- Serde for JSON serialization

## ğŸ… Success Criteria

**This project wins if:**
1. âœ… All 43 files compile/build without errors
2. âœ… Smart contracts deploy to Sui testnet successfully
3. âœ… ZK circuits generate and verify proofs
4. âœ… Nautilus TEE service runs (even in dev mode without actual Nitro)
5. âœ… Frontend connects to Sui wallet
6. âœ… End-to-end flow works: Upload â†’ Generate Proof â†’ List â†’ Purchase
7. âœ… Deployed to Walrus Sites
8. âœ… Demo video showing all features
9. âœ… Clear documentation in README

## ğŸš¨ Common Pitfalls to Avoid

1. **ZK Verification**: Must use `sui::groth16` module, not external verifier
2. **Proof Format**: Must convert to `vector<u8>` for Move contracts
3. **Wallet Connection**: Must wrap app in SuiClientProvider + WalletProvider
4. **CORS**: Backend must have CORS enabled for frontend
5. **Environment Variables**: Must use NEXT_PUBLIC_ prefix for client-side vars
6. **Sui Gas**: Need testnet SUI from faucet before transactions
7. **Circom Compilation**: Must install circomlib before compiling circuits
8. **Docker**: Must use multi-stage builds to reduce image size

## ğŸ’¡ When I'm Stuck...

**Ask me to:**
- "Create the complete [filename] with all dependencies"
- "Debug this error: [error message]"
- "Explain how [component] integrates with [other component]"
- "Generate the deployment script for [service]"
- "Write tests for [module]"

**I should NOT need to:**
- Ask you to "fill in the placeholder"
- Manually add imports
- Debug basic syntax errors
- Write boilerplate code
- Look up documentation for standard libraries

## ğŸ¬ Final Goal

By the end, I should have:
- âœ… Working local development environment
- âœ… All contracts deployed to Sui testnet
- âœ… ZK circuits generating valid proofs
- âœ… Frontend deployed to Walrus Sites
- âœ… 3-minute demo video
- âœ… GitHub repo with all code
- âœ… Submitted to Devfolio before Nov 23

---

**Now, whenever I ask you to create a file, use this context to:**
1. Understand how it fits into the overall architecture
2. Include proper integrations with other components
3. Use the correct dependencies and imports
4. Follow the established patterns and conventions
5. Add necessary error handling and logging
6. Make it production-ready, not just a demo

**Let's build a hackathon-winning project! ğŸ†**