(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{7973:function(e,t,a){Promise.resolve().then(a.bind(a,2368))},2368:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j},dynamic:function(){return v}});var s=a(7437),r=a(2265),i=a(5368),n=a(3448),l=a(4732),o=a(3976),d=a(2089),c=a(2567),m=a(336),u=a(5281),x=a(9306),g=a(7541),h=a(8855),p=a(9763);const y=(0,p.Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);var f=a(4286);const b=(0,p.Z)("Layers3",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m6.08 9.5-3.5 1.6a1 1 0 0 0 0 1.81l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9a1 1 0 0 0 0-1.83l-3.5-1.59",key:"1e5n1m"}],["path",{d:"m6.08 14.5-3.5 1.6a1 1 0 0 0 0 1.81l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9a1 1 0 0 0 0-1.83l-3.5-1.59",key:"1iwflc"}]]);var w=a(5382);const v="force-dynamic";function j(){const e=(0,i.t)(),t=(null===e||void 0===e?void 0:e.address)||"",[a,p]=(0,r.useState)(!1),[v,j]=(0,r.useState)({loading:!1,error:null,items:[]}),[N,k]=(0,r.useState)(null),{executeTransaction:_,waitForTransaction:E}=(0,l.Z)(),{downloading:Z,error:z,plaintext:L,filename:S,contentType:C,downloadAndDecrypt:D,reset:T}=(0,g.Z)(),{attestations:F,loading:R,error:U,createAttestation:O}=(0,w.Z)(t||void 0),[V,I]=(0,r.useState)(""),[M,Y]=(0,r.useState)(""),[q,A]=(0,r.useState)(!1),[B,P]=(0,r.useState)(null),[W,K]=(0,r.useState)(null);return(0,r.useEffect)((()=>{p(!0)}),[]),(0,r.useEffect)((()=>{let e=!0;if(t)return j((e=>({...e,loading:!0,error:null}))),(0,c.Bz)(t).then((t=>e&&j({loading:!1,error:null,items:t}))).catch((t=>e&&j({loading:!1,error:t.message,items:[]}))),()=>{e=!1}}),[t]),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("header",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Your ZeroVault"}),(0,s.jsx)("p",{className:"mt-1 text-gray-300",children:t?(0,s.jsxs)(s.Fragment,{children:["Connected as"," ",(0,s.jsx)("span",{className:"font-medium text-white",children:(0,n.FP)(t)}),". Manage the datasets you've uploaded and decrypt previews after secure purchase."]}):"Connect your wallet to view and manage your datasets."})]}),W?(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(h.Z,{status:W.status,digest:W.digest,message:W.message})}):null,t?(0,s.jsxs)("section",{className:"rounded-lg border border-white/10 bg-white/5 p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"rounded-md bg-white/10 p-2",children:(0,s.jsx)(y,{className:"h-4 w-4 text-blue-300"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-gray-100",children:"zkEmail creator verification"}),(0,s.jsx)("p",{className:"text-xs text-gray-300",children:"Prove you control an email address off-chain with zkEmail, then record the attestation here to show a verified creator badge."})]})]}),F.length>0?(0,s.jsxs)("div",{className:"flex items-center gap-1 rounded-full border border-emerald-500/40 bg-emerald-500/10 px-3 py-1 text-[11px] text-emerald-200",children:[(0,s.jsx)(f.Z,{className:"h-3.5 w-3.5"}),(0,s.jsxs)("span",{children:["Verified: @",F[0].domain]})]}):(0,s.jsx)("span",{className:"text-[11px] text-gray-400",children:"No zkEmail attestation yet"})]}),(0,s.jsxs)("form",{onSubmit:async function(e){if(e.preventDefault(),t){P(null);try{A(!0);const e=M.trim(),t=V.trim().toLowerCase();K({status:"pending",digest:e||void 0,message:"Verifying zkEmail transaction on Sui and recording attestation\u2026"}),await O(t,e),I(""),Y(""),K({status:"success",digest:e||void 0,message:"zkEmail attestation recorded for ".concat(t,". This transaction belongs to your wallet and succeeded on Sui.")})}catch(a){P(a.message||"Failed to record zkEmail attestation"),K({status:"failed",digest:M.trim()||void 0,message:a.message||"Failed to verify zkEmail transaction or record attestation"})}finally{A(!1)}}},className:"mt-2 grid grid-cols-1 gap-3 sm:grid-cols-[2fr_2fr_auto]",children:[(0,s.jsx)("input",{type:"email",placeholder:"you@example.com",value:V,onChange:e=>I(e.target.value),className:"rounded-md border border-white/10 bg-black/40 px-3 py-2 text-xs text-gray-100 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,s.jsx)("input",{type:"text",placeholder:"Sui tx digest from zkEmail verification",value:M,onChange:e=>Y(e.target.value),className:"rounded-md border border-white/10 bg-black/40 px-3 py-2 text-xs text-gray-100 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,s.jsx)("button",{type:"submit",disabled:q||!V||!M,className:"rounded-md bg-blue-600 px-4 py-2 text-xs font-medium text-white disabled:opacity-50 hover:bg-blue-500",children:q?"Saving\u2026":"Record zkEmail"})]}),R?(0,s.jsx)("p",{className:"text-[11px] text-gray-400",children:"Loading existing attestations\u2026"}):null,U||B?(0,s.jsx)("p",{className:"text-[11px] text-red-300",children:B||U}):null,F.length>0?(0,s.jsxs)("div",{className:"mt-2 space-y-1 text-[11px] text-gray-400",children:[(0,s.jsx)("p",{className:"font-semibold text-gray-300",children:"Recent attestations"}),F.slice(0,2).map((e=>(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsxs)("span",{className:"text-gray-200",children:["@",e.domain]}),(0,s.jsxs)("span",{className:"text-gray-500",children:["\xb7 ",(0,n.i$)(new Date(e.created_at).getTime())]}),(0,s.jsx)("a",{href:"https://explorer.sui.io/txblock/".concat(e.transaction_digest,"?network=").concat(encodeURIComponent("testnet".toLowerCase())),target:"_blank",rel:"noreferrer",className:"underline decoration-dotted hover:text-gray-200",children:"View tx"})]},e.id)))]}):null]}):null,N?(0,s.jsx)("div",{className:"sticky top-4 z-10",children:(0,s.jsx)(h.Z,{status:N.status,digest:N.digest,message:N.message})}):null,t?v.loading?(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(m.Z,{message:"Loading your datasets..."})}):v.error?(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(u.Z,{error:v.error})}):(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-sm font-semibold text-gray-200 uppercase tracking-wide",children:"Your datasets"}),(0,s.jsx)("a",{href:"/upload",className:"text-xs rounded-md border border-white/10 bg-white/5 px-2.5 py-1 text-gray-100 hover:bg-white/10",children:"Upload new"})]}),0===v.items.length?(0,s.jsxs)("div",{className:"rounded-lg border border-dashed border-white/15 bg-white/5 p-4 text-sm text-gray-300",children:["You haven\\'t uploaded any datasets yet."," ",(0,s.jsx)("a",{href:"/upload",className:"font-medium text-blue-400 hover:text-blue-300",children:"Upload your first dataset"})," ","to mint a new ZeroVault entry backed by ZK proofs."]}):(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:v.items.map((e=>{var r;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x.Z,{id:e.id,name:e.name,description:e.description,creator:e.creator,price:e.price,qualityScore:Number(e.quality_score||0),blobId:e.blob_id,verifiedDomain:null===(r=F[0])||void 0===r?void 0:r.domain,onDownload:()=>async function(e){const t=await D(e.id);try{const a=t,s=a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength),r=new Blob([s],{type:C||"application/octet-stream"}),i=URL.createObjectURL(r),n=document.createElement("a");n.href=i;const l="".concat(e.name||"zerovault-dataset","-").concat(e.id),o=S||l;n.download=o,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}catch(a){console.error("Failed to trigger dataset download",a)}}(e)}),(0,s.jsxs)("button",{type:"button",disabled:!t,onClick:()=>async function(e){if(!a)throw new Error("Wallet not ready");if(!t)throw new Error("Connect your wallet to list");if(!o.lD.package||!o.lD.marketplace)throw new Error("Marketplace contract IDs are not configured");const s=(0,n.z8)(await(0,n.Mp)(e.id)),r=(new TextEncoder).encode(e.blob_id||""),i=BigInt(e.price||"0"),l=Number(e.quality_score||0),c=(0,n.z8)("string"===typeof e.seal_policy_id&&e.seal_policy_id.startsWith("0x")?e.seal_policy_id:"0x".concat(e.seal_policy_id)),m=(0,n.z8)(o.lD.marketplace),u=new d.Y;u.moveCall({target:"".concat((0,n.z8)(o.lD.package),"::marketplace::list_dataset"),arguments:[u.object(m),u.pure.address(s),u.pure.u64(i),u.pure.vector("u8",Array.from(r)),u.pure.address(c),u.pure.u8(l)]}),k({status:"pending",message:'Listing "'.concat(e.name,'" on-chain\u2026')});try{const t=await _(u);k({status:"pending",digest:t,message:'Listing "'.concat(e.name,'" on-chain\u2026')}),await E(t),k({status:"success",digest:t,message:'Dataset "'.concat(e.name,'" successfully listed on-chain. This is a real Sui transaction.')})}catch(g){var x;throw k({status:"failed",message:null!==(x=g.message)&&void 0!==x?x:"Failed to list dataset on-chain"}),g}}(e),className:"inline-flex items-center justify-center gap-1.5 rounded-md border border-white/10 bg-white/5 px-3 py-1.5 text-[11px] font-medium text-gray-100 hover:bg-white/10 disabled:opacity-50",children:[(0,s.jsx)(b,{className:"h-3.5 w-3.5"}),"List on-chain"]})]},e.id)}))})]}):null,N?(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(h.Z,{status:N.status,digest:N.digest,message:N.message})}):null,z?(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(u.Z,{error:z,onRetry:T})}):null,L?(0,s.jsxs)("div",{className:"mt-4 rounded-md border border-white/10 bg-white/5 p-3",children:[(0,s.jsx)("p",{className:"mb-1 text-xs text-gray-300",children:"Decrypted preview (first 256 bytes, UTF-8):"}),(0,s.jsx)("pre",{className:"max-h-40 overflow-auto whitespace-pre-wrap break-all text-xs text-gray-100",children:(new TextDecoder).decode(L.subarray(0,256))})]}):null]})}}},function(e){e.O(0,[368,14,56,62,971,117,744],(function(){return t=7973,e(e.s=t);var t}));var t=e.O();_N_E=t}]);