(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{8633:function(e,t,s){Promise.resolve().then(s.bind(s,5346))},5346:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return v},dynamic:function(){return y}});var a=s(7437),r=s(2265),i=s(2567),n=s(9306),l=s(336),o=s(5281),c=s(4732),d=s(3976),u=s(2089),h=s(3448),m=s(8855),p=s(7541),x=s(5382),g=s(9763);const f=(0,g.Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),b=(0,g.Z)("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);var w=s(4286);const y="force-dynamic";function v(){const{datasets:e,isLoading:t,error:s,refetch:g}=(0,i.ZP)(),[y,v]=(0,r.useState)(""),[j,N]=(0,r.useState)(0),{executeTransaction:k,waitForTransaction:C,account:_}=(0,c.Z)(),{downloading:L,error:S,plaintext:E,filename:Z,contentType:D,downloadAndDecrypt:P,reset:M}=(0,p.Z)(),T=(null===_||void 0===_?void 0:_.address)||"",{attestations:R}=(0,x.Z)(T||void 0),[A,I]=(0,r.useState)([]),[B,U]=(0,r.useState)(null),[z,O]=(0,r.useState)(void 0),[q,F]=(0,r.useState)(null),[V,K]=(0,r.useState)(!1);(0,r.useEffect)((()=>{K(!0)}),[]);const W=(0,r.useMemo)((()=>(e||[]).filter((e=>{const t=Number(e.quality_score||0)>=(j||0),s=!y||e.name.toLowerCase().includes(y.toLowerCase())||e.description.toLowerCase().includes(y.toLowerCase());return t&&s}))),[e,y,j]),X=((0,r.useMemo)((()=>(null===e||void 0===e?void 0:e.length)?e.reduce(((e,t)=>e+Number(t.price||0)),0):0),[e]),(0,r.useMemo)((()=>{if(!(null===e||void 0===e?void 0:e.length))return 0;const t=e.map((e=>Number(e.quality_score||0)));return Math.round(t.reduce(((e,t)=>e+t),0)/t.length)}),[e]));var G,Q;return(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("header",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col items-start justify-between gap-3 sm:flex-row sm:items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white",children:"ZeroVault marketplace"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-300",children:"Browse encrypted datasets with on-chain provenance. Every purchase runs through Walrus, Seal, Nautilus, and Sui."})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 justify-start sm:justify-end",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search datasets...",value:y,onChange:e=>v(e.target.value),className:"rounded-md border border-white/10 bg-white/5 px-3 py-1.5 text-sm text-gray-100 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsxs)("div",{className:"inline-flex items-center gap-1 rounded-full border border-white/10 bg-white/5 px-1.5 py-1 text-[11px] text-gray-200",children:[(0,a.jsx)("span",{className:"hidden sm:inline text-gray-400 mr-1",children:"Quality:"}),[0,70,80,90].map((e=>(0,a.jsx)("button",{type:"button",onClick:()=>N(e),className:"rounded-full px-2 py-0.5 transition ".concat(j===e?"bg-blue-500 text-white":"bg-transparent text-gray-200 hover:bg-white/10"),children:0===e?"All":"".concat(e,"+")},e)))]}),(0,a.jsxs)("button",{type:"button",onClick:()=>g(),className:"inline-flex items-center gap-1 rounded-md border border-white/10 bg-white/5 px-3 py-1.5 text-sm text-white hover:bg-white/10",children:[(0,a.jsx)(f,{className:"h-4 w-4"}),"Refresh"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3 text-xs text-gray-300 sm:grid-cols-3",children:[(0,a.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-3 flex items-center gap-2",children:[(0,a.jsx)(b,{className:"h-4 w-4 text-blue-300"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-100",children:"Listings"}),(0,a.jsxs)("p",{children:[null!==(G=null===e||void 0===e?void 0:e.length)&&void 0!==G?G:0," total datasets"]})]})]}),(0,a.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-3 flex items-center gap-2",children:[(0,a.jsx)(w.Z,{className:"h-4 w-4 text-emerald-300"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-100",children:"Average quality"}),(0,a.jsxs)("p",{children:[X||0," / 100 (Nautilus score)"]})]})]}),(0,a.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-3 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-purple-500 text-xs font-bold text-white",children:"ZV"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-100",children:"Real purchases"}),(0,a.jsx)("p",{children:"Pay with Sui PTBs; proofs verified on-chain."})]})]})]}),B?(0,a.jsx)("div",{className:"sticky top-4 z-10",children:(0,a.jsx)(m.Z,{status:"pending"===B?"pending":"success"===B?"success":"failed",digest:z,message:q||("pending"===B?"Processing your purchase on Sui\u2026":"Purchase completed. This is a real Sui transaction.")})}):null]}),t?(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(l.Z,{message:"Loading datasets..."})}):null,s?(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(o.Z,{error:s,onRetry:()=>g()})}):null,(0,a.jsxs)("section",{className:"mt-2 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold uppercase tracking-wide text-gray-200",children:"Available datasets"}),(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:["Showing ",W.length," of ",null!==(Q=null===e||void 0===e?void 0:e.length)&&void 0!==Q?Q:0]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:null===W||void 0===W?void 0:W.map((e=>{const t=A.includes(e.id),s=R.length>0&&e.creator&&T&&e.creator.toLowerCase()===T.toLowerCase()?R[0].domain:void 0;return(0,a.jsx)(n.Z,{id:e.sui_object_id||e.id,name:e.name,description:e.description,creator:e.creator,price:e.price,qualityScore:Number(e.quality_score||0),blobId:e.blob_id,verifiedDomain:s,onPurchase:()=>async function(e){if(!V)throw new Error("Wallet not ready");if(!(null===_||void 0===_?void 0:_.address))throw new Error("Connect your wallet to purchase");if(!d.lD.package||!d.lD.marketplace)throw new Error("Marketplace contract IDs are not configured (NEXT_PUBLIC_PACKAGE_ID / NEXT_PUBLIC_MARKETPLACE_ID)");const t=(0,h.z8)(await(0,h.Mp)(e.id)),s=BigInt(e.price||"0");if(s<=0n)throw new Error("Invalid dataset price");const a=(0,h.z8)(d.lD.marketplace),r=(0,h.z8)(d.SL),i=new u.Y,[n]=i.splitCoins(i.gas,[s]);i.moveCall({target:"".concat((0,h.z8)(d.lD.package),"::marketplace::purchase_dataset"),arguments:[i.object(a),i.pure.address(t),n,i.pure.address(r)]});try{U("pending"),F(null),O(void 0);const t=await k(i);O(t);const s=await C(t);U(s?"success":"failed"),s&&I((t=>t.includes(e.id)?t:[...t,e.id])),await g()}catch(l){U("failed"),F(l.message||String(l))}}(e),onDownload:t?()=>async function(e){const t=await P(e.id);try{const s=t,a=s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength),r=new Blob([a],{type:D||"application/octet-stream"}),i=URL.createObjectURL(r),n=document.createElement("a");n.href=i;const l="".concat(e.name||"zerovault-dataset","-").concat(e.id),o=Z||l;n.download=o,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}catch(s){console.error("Failed to trigger dataset download from marketplace",s)}}(e):void 0},e.id)}))}),t||s||0!==W.length?null:(0,a.jsx)("p",{className:"mt-4 text-sm text-gray-400",children:"No datasets match your filters yet."})]}),S?(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(o.Z,{error:S,onRetry:M})}):null,E?(0,a.jsxs)("div",{className:"mt-4 rounded-md border border-white/10 bg-white/5 p-3",children:[(0,a.jsx)("p",{className:"mb-1 text-xs text-gray-300",children:"Decrypted preview (first 256 bytes, UTF-8):"}),(0,a.jsx)("pre",{className:"max-h-40 overflow-auto whitespace-pre-wrap break-all text-xs text-gray-100",children:(new TextDecoder).decode(E.subarray(0,256))})]}):null]})}}},function(e){e.O(0,[368,14,56,62,971,117,744],(function(){return t=8633,e(e.s=t);var t}));var t=e.O();_N_E=t}]);